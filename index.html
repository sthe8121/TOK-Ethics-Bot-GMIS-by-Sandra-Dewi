<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TOK Exhibition Mentor Bot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.0.3/docx.umd.min.js"></script>
  <style>
    h1, h2, button {
      word-break: break-word;
    }
    textarea, input, select {
      font-size: 1rem;
    }
  </style>
</head>
<body class="bg-gray-50 p-4 sm:p-6 font-sans text-base">
  <div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-md space-y-6">
    <div class="flex items-center justify-between border-b pb-4 mb-4">
      <img src="GMIS_logo_highres.png" alt="GMIS Logo" class="h-12 w-auto">
      <span class="text-right text-sm font-medium text-gray-700">Gandhi Memorial Intercontinental School Jakarta,<br>IB World School</span>
    </div>
  
    <div class="text-right">
      <select id="langToggle" onchange="setLanguage(this.value)" class="text-sm border rounded px-2 py-1">
        <option value="en">English</option>
        <option value="ko">ÌïúÍµ≠Ïñ¥ (Korean)</option>
        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
      </select>
    </div>

    <!-- Step 1: IA Prompt Selection -->
    <section class="space-y-2 sm:space-y-4" id="step1">
      <h2 class="font-semibold text-lg mb-2">1. Select Your IA Prompt</h2>
      <select id="iaPrompt" class="w-full border p-2 rounded mb-4">
        <option value="">-- Select your prompt --</option>
        <option value="What is the relationship between personal experience and knowledge?">What is the relationship between personal experience and knowledge?</option>
        <option value="Are some types of knowledge more useful than others?">Are some types of knowledge more useful than others?</option>
        <option value="On what grounds might we doubt a claim?">On what grounds might we doubt a claim?</option>
      </select>
      <button onclick="goToStep(2)" class="bg-blue-600 text-white px-4 py-2 rounded w-full">Next</button>
    </section>

    <!-- Step 2: Prompt Interpretation -->
    <section class="space-y-2 sm:space-y-4 hidden" id="step2">
      <h2 class="font-semibold text-lg mb-2">2. Interpret the Prompt</h2>
      <p class="text-gray-700 mb-2">What does this prompt mean to you?</p>
      <input type="text" id="promptInterpretation" placeholder="This prompt invites exploration of..." class="w-full border p-2 rounded mb-4" />
      <button onclick="goToStep('5a')" class="bg-blue-600 text-white px-4 py-2 rounded w-full">Start Commentary</button>
    </section>

    <!-- Step 5A: Object 1 -->
    <section class="space-y-2 sm:space-y-4 hidden" id="step5a">
      <h2 class="font-semibold text-lg mb-2">3. Commentary ‚Äì Object 1</h2>
      <input type="text" id="obj1Title" placeholder="Object Title" class="w-full border p-2 rounded mb-2"/>
      <input type="text" id="obj1Context" placeholder="Real-world Context" class="w-full border p-2 rounded mb-2"/>
      <textarea id="obj1Text" placeholder="Justification & Link to Prompt" class="w-full border p-2 rounded h-40"></textarea>
      <p class="text-xs text-gray-500 mt-2">Suggested max: ~300 words.</p>
      <button onclick="goToStep('5b')" class="bg-blue-600 text-white px-4 py-2 rounded mt-4 w-full">Next Object</button>
    </section>

    <!-- Step 5B: Object 2 -->
    <section class="space-y-2 sm:space-y-4 hidden" id="step5b">
      <h2 class="font-semibold text-lg mb-2">4. Commentary ‚Äì Object 2</h2>
      <input type="text" id="obj2Title" placeholder="Object Title" class="w-full border p-2 rounded mb-2"/>
      <input type="text" id="obj2Context" placeholder="Real-world Context" class="w-full border p-2 rounded mb-2"/>
      <textarea id="obj2Text" placeholder="Justification & Link to Prompt" class="w-full border p-2 rounded h-40"></textarea>
      <p class="text-xs text-gray-500 mt-2">Suggested max: ~300 words.</p>
      <button onclick="goToStep('5c')" class="bg-blue-600 text-white px-4 py-2 rounded mt-4 w-full">Next Object</button>
    </section>

    <!-- Step 5C: Object 3 -->
    <section class="space-y-2 sm:space-y-4 hidden" id="step5c">
      <h2 class="font-semibold text-lg mb-2">5. Commentary ‚Äì Object 3</h2>
      <input type="text" id="obj3Title" placeholder="Object Title" class="w-full border p-2 rounded mb-2"/>
      <input type="text" id="obj3Context" placeholder="Real-world Context" class="w-full border p-2 rounded mb-2"/>
      <textarea id="obj3Text" placeholder="Justification & Link to Prompt" class="w-full border p-2 rounded h-40"></textarea>
      <p class="text-xs text-gray-500 mt-2">Suggested max: ~300 words. IB limit = 950 words total.</p>
      <button onclick="goToStep(6)" class="bg-blue-600 text-white px-4 py-2 rounded mt-4 w-full">Finish</button>
    </section>

    <!-- Step 6: Export -->
    <section class="space-y-2 sm:space-y-4 hidden" id="step6">
      <h2 class="font-semibold text-lg mb-2">6. Export Your Draft</h2>
      <p class="text-gray-700 mb-2">You‚Äôve now completed your draft commentaries for all 3 objects.</p>
      <button onclick="downloadTxtFile()" class="border border-blue-600 text-blue-600 px-4 py-2 rounded w-full">‚¨áÔ∏è Export .txt</button>
      <button onclick="downloadDocxFile()" class="bg-blue-600 text-white px-4 py-2 rounded mt-2 w-full">üìù Export .docx</button>
      <p class="text-xs text-gray-500 mt-4">Reminder: IB word count limit is 950 words (excluding references).</p>
      <button onclick="goToStep('7')" class="bg-blue-600 text-white px-4 py-2 rounded mt-4 w-full">Continue to Self-Check</button>
      <a href="TOK_Mentor_Bot_v3.8_Offline_Pack.zip" class="text-blue-600 underline text-sm block mt-4" download>‚¨áÔ∏è Download ZIP for Offline Use</a>
    </section>

    <!-- Step 7: Self-Check Checklist -->
    <section class="space-y-2 sm:space-y-4 hidden" id="step7">
      <h2 class="font-semibold text-lg mb-2">7. Self-Check Checklist</h2>
      <p class="text-gray-700 mb-2">Reflect on the TOK Exhibition criteria:</p>
      <div class="space-y-2">
        <label class="flex items-center">
          <input type="checkbox" onchange="updateSelfCheckScore()" class="mr-2" />
          Have I clearly linked each object to the IA prompt?
        </label>
        <label class="flex items-center">
          <input type="checkbox" onchange="updateSelfCheckScore()" class="mr-2" />
          Did I justify the inclusion of each object using TOK concepts?
        </label>
        <label class="flex items-center">
          <input type="checkbox" onchange="updateSelfCheckScore()" class="mr-2" />
          Is my total word count below 950 words?
        </label>
      </div>
      <p class="text-sm text-gray-600 mt-4">Self-Check Score: <span id="selfCheckScore">0</span>/3</p>
      <button onclick="goToStep('8')" class="bg-blue-600 text-white px-4 py-2 rounded mt-4 w-full">Continue to Reflection</button>
    </section>

    <!-- Step 8: Reflection Export -->
    <section class="space-y-2 sm:space-y-4 hidden" id="step8">
      <h2 class="font-semibold text-lg mb-2">8. Final Reflection (Optional)</h2>
      <textarea id="finalReflection" placeholder="Write your overall insights here..." class="w-full border p-2 rounded h-40 mb-4"></textarea>
      <h3 class="font-medium text-sm text-gray-600 mt-4">üìÑ Preview of Export Content:</h3>
      <textarea id="previewArea" class="w-full h-64 p-2 border rounded bg-gray-50 text-xs font-mono mb-4" readonly></textarea>
      <button onclick="saveReflection()" class="bg-blue-600 text-white px-4 py-2 rounded mr-2 w-full">üíæ Save Final Reflection</button>
      <button onclick="copyAllToClipboard()" class="bg-blue-600 text-white px-4 py-2 rounded mr-2 w-full">üìã Copy All</button>
      <button onclick="downloadTxtFile()" class="bg-blue-600 text-white px-4 py-2 rounded w-full">‚¨áÔ∏è Export .txt</button>
      <button onclick="downloadDocxFile()" class="bg-blue-600 text-white px-4 py-2 rounded mt-2 w-full">üìù Export .docx</button>
      <a href="TOK_Mentor_Bot_v3.8_Offline_Pack.zip" class="text-blue-600 underline text-sm block mt-4" download>‚¨áÔ∏è Download ZIP for Offline Use</a>
    </section>

    <!-- Footer -->
    <footer class="pt-6 text-xs text-gray-400 border-t mt-6">
      TOK Bot 4.1 Multilingual Tools for Equitable Access to Quality Education (Internal Use) | Leading SDG4 | GMIS Innovation Lab 2025 | Virtute et Labore | by Sandra Dewi
    </footer>
  </div>

  <script>
    function goToStep(stepId) {
      const steps = ['step1','step2','step5a','step5b','step5c','step6','step7','step8'];
      steps.forEach(id => document.getElementById(id).classList.add('hidden'));
      document.getElementById('step' + stepId).classList.remove('hidden');
    }

    function updateSelfCheckScore() {
      const checkboxes = document.querySelectorAll('#step7 input[type="checkbox"]');
      const score = Array.from(checkboxes).filter(checkbox => checkbox.checked).length;
      document.getElementById('selfCheckScore').textContent = score;
    }

    function updatePreview() {
      document.getElementById('previewArea').value = generateExportText();
    }

    function saveReflection() {
      const ref = document.getElementById('finalReflection').value;
      localStorage.setItem('finalReflection', ref);
      updatePreview();
      alert('Reflection saved locally.');
    }

    function copyAllToClipboard() {
      const data = generateExportText();
      navigator.clipboard.writeText(data).then(() => {
        updatePreview();
        alert('All content copied to clipboard!');
      });
    }

    function downloadTxtFile() {
      const content = generateExportText();
      const blob = new Blob([content], { type: 'text/plain' });
      const link = document.createElement('a');
      link.download = 'TOK_Exhibition_Draft.txt';
      link.href = window.URL.createObjectURL(blob);
      link.click();
    }

    async function downloadDocxFile() {
      const getVal = id => document.getElementById(id)?.value || '';
      const { Document, Packer, Paragraph, TextRun } = window.docx;

      const makeHeading = text => new Paragraph({
        children: [new TextRun({ text, bold: true })],
        spacing: { after: 200 }
      });

      const makeText = text => new Paragraph({
        children: [new TextRun({ text })],
        spacing: { after: 300 }
      });

      const doc = new Document({
        sections: [{
          children: [
            makeHeading("TOK Exhibition Draft ‚Äì v3.1"),
            makeHeading("IA Prompt:"),
            makeText(getVal('iaPrompt')),
            makeHeading("Interpretation:"),
            makeText(getVal('promptInterpretation')),

            makeHeading("--- Object 1 ---"),
            makeHeading("Title:"),
            makeText(getVal('obj1Title')),
            makeHeading("Context:"),
            makeText(getVal('obj1Context')),
            makeHeading("Commentary:"),
            makeText(getVal('obj1Text')),

            makeHeading("--- Object 2 ---"),
            makeHeading("Title:"),
            makeText(getVal('obj2Title')),
            makeHeading("Context:"),
            makeText(getVal('obj2Context')),
            makeHeading("Commentary:"),
            makeText(getVal('obj2Text')),

            makeHeading("--- Object 3 ---"),
            makeHeading("Title:"),
            makeText(getVal('obj3Title')),
            makeHeading("Context:"),
            makeText(getVal('obj3Context')),
            makeHeading("Commentary:"),
            makeText(getVal('obj3Text')),

            makeHeading("Final Reflection:"),
            makeText(getVal('finalReflection'))
          ]
        }]
      });

      const blob = await Packer.toBlob(doc);
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "TOK_Exhibition_Draft.docx";
      link.click();
    }

    function generateExportText() {
      const getVal = id => document.getElementById(id)?.value || '';
      return `
TOK Exhibition Draft ‚Äì v3.1
IA Prompt: ${getVal('iaPrompt')}
Interpretation: ${getVal('promptInterpretation')}

--- Object 1 ---
Title: ${getVal('obj1Title')}
Context: ${getVal('obj1Context')}
Commentary:
${getVal('obj1Text')}

--- Object 2 ---
Title: ${getVal('obj2Title')}
Context: ${getVal('obj2Context')}
Commentary:
${getVal('obj2Text')}

--- Object 3 ---
Title: ${getVal('obj3Title')}
Context: ${getVal('obj3Context')}
Commentary:
${getVal('obj3Text')}

--- Final Reflection ---
${getVal('finalReflection')}
      `.trim();
    }

    const langMap = {
      en: {
        step1: "1. Select Your IA Prompt",
        step2: "2. Interpret the Prompt",
        step3a: "3. Commentary ‚Äì Object 1",
        step3b: "4. Commentary ‚Äì Object 2",
        step3c: "5. Commentary ‚Äì Object 3",
        export6: "6. Export Your Draft",
        checklist7: "7. Self-Check Checklist",
        reflect8: "8. Final Reflection (Optional)"
      },
      ko: {
        step1: "1. IA ÌîÑÎ°¨ÌîÑÌä∏ ÏÑ†ÌÉù",
        step2: "2. ÌîÑÎ°¨ÌîÑÌä∏ Ìï¥ÏÑù",
        step3a: "3. Ìï¥ÏÑ§ ‚Äì Í∞ùÏ≤¥ 1",
        step3b: "4. Ìï¥ÏÑ§ ‚Äì Í∞ùÏ≤¥ 2",
        step3c: "5. Ìï¥ÏÑ§ ‚Äì Í∞ùÏ≤¥ 3",
        export6: "6. Ï¥àÏïà ÎÇ¥Î≥¥ÎÇ¥Í∏∞",
        checklist7: "7. ÏûêÍ∏∞ Ï†êÍ≤Ä Î™©Î°ù",
        reflect8: "8. ÏµúÏ¢Ö ÏÑ±Ï∞∞ (ÏÑ†ÌÉùÏÇ¨Ìï≠)"
      },
      hi: {
        step1: "1. ‡§Ö‡§™‡§®‡§æ IA ‡§™‡•ç‡§∞‡•â‡§Æ‡•ç‡§™‡•ç‡§ü ‡§ö‡•Å‡§®‡•á‡§Ç",
        step2: "2. ‡§™‡•ç‡§∞‡•â‡§Æ‡•ç‡§™‡•ç‡§ü ‡§ï‡•Ä ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡§∞‡•á‡§Ç",
        step3a: "3. ‡§ü‡§ø‡§™‡•ç‡§™‡§£‡•Ä ‚Äì ‡§µ‡§∏‡•ç‡§§‡•Å 1",
        step3b: "4. ‡§ü‡§ø‡§™‡•ç‡§™‡§£‡•Ä ‚Äì ‡§µ‡§∏‡•ç‡§§‡•Å 2",
        step3c: "5. ‡§ü‡§ø‡§™‡•ç‡§™‡§£‡•Ä ‚Äì ‡§µ‡§∏‡•ç‡§§‡•Å 3",
        export6: "6. ‡§Ö‡§™‡§®‡§æ ‡§°‡•ç‡§∞‡§æ‡§´‡•ç‡§ü ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç",
        checklist7: "7. ‡§∏‡•ç‡§µ‡§Ø‡§Ç-‡§ú‡§æ‡§Ç‡§ö ‡§ö‡•á‡§ï‡§≤‡§ø‡§∏‡•ç‡§ü",
        reflect8: "8. ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§ö‡§ø‡§Ç‡§§‡§® (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)",
 
        placeholders: {
          promptInterpretation: "‡§Ø‡§π ‡§™‡•ç‡§∞‡•â‡§Æ‡•ç‡§™‡•ç‡§ü ‡§Ü‡§™‡§ï‡•ã ‡§Ø‡§π ‡§ñ‡•ã‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ç‡§∞‡•á‡§∞‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à...",
          objTitle: "‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡§æ ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï",
          objContext: "‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§¶‡•Å‡§®‡§ø‡§Ø‡§æ ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠",
          objCommentary: "‡§î‡§ö‡§ø‡§§‡•ç‡§Ø ‡§î‡§∞ ‡§™‡•ç‡§∞‡•â‡§Æ‡•ç‡§™‡•ç‡§ü ‡§∏‡•á ‡§≤‡§ø‡§Ç‡§ï",
          finalReflection: "‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡•á ‡§∏‡§Æ‡§ó‡•ç‡§∞ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§≤‡§ø‡§ñ‡•á‡§Ç..."
        },
 
        buttons: {
          next: "‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç",
          startCommentary: "‡§ü‡§ø‡§™‡•ç‡§™‡§£‡•Ä ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
          nextObject: "‡§Ö‡§ó‡§≤‡•Ä ‡§µ‡§∏‡•ç‡§§‡•Å",
          finish: "‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç",
          exportTXT: "TXT ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç",
          exportDOCX: "üìù .docx ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç",
          continueSelfCheck: "‡§∏‡•ç‡§µ‡§Ø‡§Ç-‡§ú‡§æ‡§Ç‡§ö ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç",
          continueReflection: "‡§ö‡§ø‡§Ç‡§§‡§® ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Å",
          saveReflection: "üíæ ‡§ö‡§ø‡§Ç‡§§‡§® ‡§∏‡§π‡•á‡§ú‡•á‡§Ç",
          copyAll: "üìã ‡§∏‡§¨ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç",
          downloadTXT: "‚¨áÔ∏è .txt ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
          downloadDOCX: "üìù .docx ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç"
        },
 
        selfCheckItems: [
          "‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡•à‡§Ç‡§®‡•á ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡•ã IA ‡§™‡•ç‡§∞‡•â‡§Æ‡•ç‡§™‡•ç‡§ü ‡§∏‡•á ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ú‡•ã‡§°‡§º‡§æ ‡§π‡•à?",
          "‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡•à‡§Ç‡§®‡•á TOK ‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡•ã ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§î‡§ö‡§ø‡§§‡•ç‡§Ø ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡•Å‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à?",
          "‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡•á‡§∞‡•Ä ‡§ï‡•Å‡§≤ ‡§∂‡§¨‡•ç‡§¶ ‡§∏‡•Ä‡§Æ‡§æ 950 ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§∏‡•á ‡§ï‡§Æ ‡§π‡•à?"
        ]
      }
    };

    function setLanguage(lang) {
      const map = langMap[lang];
 
      // Headings
      document.querySelector('#step1 h2').textContent = map.step1;
      document.querySelector('#step2 h2').textContent = map.step2;
      document.querySelector('#step5a h2').textContent = map.step3a;
      document.querySelector('#step5b h2').textContent = map.step3b;
      document.querySelector('#step5c h2').textContent = map.step3c;
      document.querySelector('#step6 h2').textContent = map.export6;
      document.querySelector('#step7 h2').textContent = map.checklist7;
      document.querySelector('#step8 h2').textContent = map.reflect8;
 
      // Placeholders (if available)
      if (map.placeholders) {
        document.getElementById('promptInterpretation').placeholder = map.placeholders.promptInterpretation;
        ['obj1', 'obj2', 'obj3'].forEach(id => {
          document.getElementById(`${id}Title`).placeholder = map.placeholders.objTitle;
          document.getElementById(`${id}Context`).placeholder = map.placeholders.objContext;
          document.getElementById(`${id}Text`).placeholder = map.placeholders.objCommentary;
        });
        document.getElementById('finalReflection').placeholder = map.placeholders.finalReflection;
      }
 
      // Buttons (if available)
      if (map.buttons) {
        document.querySelector('#step1 button').textContent = map.buttons.next;
        document.querySelector('#step2 button').textContent = map.buttons.startCommentary;
        document.querySelector('#step5a button').textContent = map.buttons.nextObject;
        document.querySelector('#step5b button').textContent = map.buttons.nextObject;
        document.querySelector('#step5c button').textContent = map.buttons.finish;
        const step6buttons = document.querySelectorAll('#step6 button');
        if (step6buttons.length >= 3) {
          step6buttons[0].textContent = map.buttons.exportTXT;
          step6buttons[1].textContent = map.buttons.exportDOCX;
          step6buttons[2].textContent = map.buttons.continueSelfCheck;
        }
        document.querySelector('#step7 button').textContent = map.buttons.continueReflection;
        const step8buttons = document.querySelectorAll('#step8 button');
        if (step8buttons.length >= 4) {
          step8buttons[0].textContent = map.buttons.saveReflection;
          step8buttons[1].textContent = map.buttons.copyAll;
          step8buttons[2].textContent = map.buttons.downloadTXT;
          step8buttons[3].textContent = map.buttons.downloadDOCX;
        }
      }
 
      // Self-Check Items (if available)
      if (map.selfCheckItems) {
        const labels = document.querySelectorAll('#step7 label');
        labels.forEach((label, index) => {
          const checkbox = label.querySelector('input');
          label.textContent = map.selfCheckItems[index] || '';
          label.prepend(checkbox);
        });
      }
    }

    window.onload = function () {
      goToStep(1);  // Ensure it starts at Step 1
      const ref = localStorage.getItem('finalReflection');
      if (ref) document.getElementById('finalReflection').value = ref;
      updatePreview();
    };
  </script>
</body>
</html>
